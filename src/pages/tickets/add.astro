---
import Layout from "../../layouts/Layout.astro";
import { turso } from "../../turso";

const currentDate = new Date().toISOString().split("T")[0];

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const passTypeID = formData.get("ticketType"); // Mapping to passTypeID
  const quantity = formData.get("quantity");
  const paymentMethodID = formData.get("paymentMethod"); // Now referencing paymentMethodID
  const statusID = 1; // Assuming 1 for 'Active' status

  // Insert data into the Passes table
  await turso.execute(`
    INSERT INTO Passes (passTypeID, quantity, paymentMethodID, statusID)
    VALUES (${passTypeID}, ${quantity}, ${paymentMethodID}, ${statusID})
  `);

  // Redirect based on payment method
  if (paymentMethodID === "1") {
    // Assuming '1' corresponds to card
    return Astro.redirect("/tickets/payment-card");
  } else {
    // Otherwise, cash
    return Astro.redirect("/tickets/payment-cash");
  }
}
---

<Layout title="Add Ticket">
  <div class="max-w-6xl mx-auto mt-12 p-8 bg-gray-800 rounded-lg shadow-md">
    <h1 class="text-3xl font-semibold text-white mb-6">Add New Pass</h1>
    
    <form class="grid grid-cols-2 gap-6" method="POST">
      <!-- Campos del pass -->
      <div>
        <label class="block text-sm font-medium text-white">Pass Type</label>
        <select name="ticketType" class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md">
          <option value="1">Time Traveler (Basic)</option>
          <option value="2">Legacy Explorer (VIP)</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-white">Quantity</label>
        <input type="number" name="quantity" class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md" placeholder="Quantity" />
      </div>

      <!-- Selección del método de pago -->
      <div class="col-span-2">
        <label class="block text-sm font-medium text-white">Payment Method</label>
        <select name="paymentMethod" class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md">
          <option value="1">Card</option>
          <option value="2">Cash</option>
        </select>
      </div>

      <div class="col-span-2 flex justify-end space-x-2">
        <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700">
          Continue
        </button>
      </div>
    </form>
  </div>
</Layout>
